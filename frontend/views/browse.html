<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browse Items - ReWear</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #e0f7fa, #fff3e0);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    .header {
      background-color: white;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      color: #2e7d32;
      font-size: 28px;
      font-weight: bold;
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 30px;
    }

    .nav-links a {
      color: #388e3c;
      text-decoration: none;
      font-size: 16px;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .nav-links a:hover {
      color: #2e7d32;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .points-badge {
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .back-btn {
      background-color: #388e3c;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      display: inline-block;
    }

    .back-btn:hover {
      background-color: #2e7d32;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    h1 {
      text-align: center;
      color: #2e7d32;
      font-size: 36px;
      margin-bottom: 30px;
    }

    .filters-section {
      background-color: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .filter-group label {
      color: #2e7d32;
      font-size: 14px;
      font-weight: bold;
    }

    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    .view-cart-section {
      text-align: center;
      margin-bottom: 30px;
    }

    .btn {
      background-color: #388e3c;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .btn:hover {
      background-color: #2e7d32;
    }

    .btn-secondary {
      background-color: #66bb6a;
      font-size: 14px;
      padding: 8px 16px;
      margin: 5px;
    }

    .btn-secondary:hover {
      background-color: #388e3c;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .product-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .product-image {
      width: 100%;
      height: 200px;
      background-color: #f5f5f5;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .product-title {
      font-size: 18px;
      color: #2e7d32;
      margin: 10px 0;
      font-weight: bold;
    }

    .product-details {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .product-price {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .product-points {
      color: #388e3c;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .product-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .cart-section {
      display: none;
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }

    .cart-section h3 {
      color: #2e7d32;
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-summary {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .cart-total {
      font-weight: bold;
      color: #2e7d32;
      font-size: 18px;
      text-align: center;
      margin: 10px 0;
    }

    .payment-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .empty-cart {
      text-align: center;
      color: #666;
      font-size: 16px;
      padding: 40px;
    }

    .footer {
      background-color: white;
      text-align: center;
      padding: 30px;
      margin-top: 50px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    .footer p {
      color: #666;
      margin: 0;
    }

    @media (max-width: 768px) {
      .nav-container {
        flex-direction: column;
        gap: 15px;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
      }

      .filters-section {
        flex-direction: column;
        align-items: stretch;
      }

      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }

      .product-actions {
        flex-direction: column;
      }

      .payment-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- Example navigation bar for all pages -->
  <div class="header">
    <div class="nav-container">
      <a href="LandingPage.html" class="logo">ReWear</a>
      <div class="nav-links">
        <a href="LandingPage.html">Home</a>
        <a href="browse.html">Browse</a>
        <a href="availablepage.html">Available Items</a>
        <a href="swap.html">Swapping</a>
        <a href="add_items.html">Add Items</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="index.html">Logout</a>
      </div>
      <div class="user-info">
        <div class="points-badge"><span id="point-balance">500</span> Points</div>
        <div class="user-profile"><div class="user-avatar">JD</div></div>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>Browse Items</h1>

    <div class="filters-section">
      <div class="filter-group">
        <label>Category</label>
        <select id="categoryFilter">
          <option value="">All Categories</option>
          <option value="tops">Tops</option>
          <option value="bottoms">Bottoms</option>
          <option value="dresses">Dresses</option>
          <option value="shoes">Shoes</option>
          <option value="accessories">Accessories</option>
          <option value="outerwear">Outerwear</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Size</label>
        <select id="sizeFilter">
          <option value="">All Sizes</option>
          <option value="XS">XS</option>
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
          <option value="XXL">XXL</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Condition</label>
        <select id="conditionFilter">
          <option value="">All Conditions</option>
          <option value="new">New</option>
          <option value="like-new">Like New</option>
          <option value="good">Good</option>
          <option value="fair">Fair</option>
        </select>
      </div>
    </div>

    <div class="view-cart-section">
      <button class="btn" onclick="toggleCart()">
        üõí View Cart (<span id="cart-count">0</span>)
      </button>
    </div>

    <div id="cart-section" class="cart-section">
      <h3>Your Cart</h3>
      <div id="cart-items">
        <div class="empty-cart">Your cart is empty</div>
      </div>
      <div class="cart-summary" id="cart-summary" style="display: none;">
        <div class="cart-total" id="cart-total"></div>
        <div class="cart-total" id="cart-points"></div>
        <div class="payment-buttons">
          <button class="btn" onclick="buyWithCash()">üí∞ Buy with Cash</button>
          <button class="btn" onclick="buyWithPoints()">‚≠ê Redeem Points</button>
        </div>
      </div>
    </div>

    <div class="products-grid" id="products-grid">
      <!-- Products will be generated by JavaScript -->
    </div>
  </div>

  <div class="footer">
    <p>&copy; 2025 ReWear - Sustainable Fashion Exchange</p>
  </div>

  <script src="../public/api.js"></script>
  <script>
    const cart = [];
    let userPoints = 500;
    let allProducts = [];

    // Check if user is logged in
    const currentUser = API.getCurrentUser();
    if (currentUser) {
      document.getElementById("user-display").textContent = `üë§ Welcome, ${currentUser.username}`;
    } else {
      document.getElementById("user-display").textContent = `üë§ Welcome, Guest`;
    }

    function updatePointsDisplay() {
      document.getElementById("point-balance").textContent = userPoints;
    }

    function updateCartCount() {
      document.getElementById("cart-count").textContent = cart.length;
    }

    function renderProducts(products = allProducts) {
      const grid = document.getElementById("products-grid");
      grid.innerHTML = "";

      if (products.length === 0) {
        grid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: #666;">No items found. Try adjusting your filters.</p>';
        return;
      }

      products.forEach(product => {
        const productCard = document.createElement("div");
        productCard.className = "product-card";
        productCard.innerHTML = `
          <div class="product-image">
            ${product.images && product.images.length > 0 
              ? `<img src="${product.images[0]}" alt="${product.title}">` 
              : "üì∑ No Image"}
          </div>
          <div class="product-title">${product.title}</div>
          <div class="product-details">
            Size: ${product.size} | Condition: ${product.condition}
          </div>
          <div class="product-price">$${UI.formatPrice(product.price)}</div>
          <div class="product-points">${Math.round(product.price / 10)} Points</div>
          <div class="product-actions">
            <button class="btn btn-secondary" onclick="addToCart('${product._id}')">Add to Cart</button>
            <button class="btn btn-secondary" onclick="viewDetails('${product._id}')">View Details</button>
          </div>
        `;
        grid.appendChild(productCard);
      });
    }

    function addToCart(productId) {
      const product = allProducts.find(p => p._id === productId);
      if (product && !cart.find(item => item._id === productId)) {
        cart.push(product);
        updateCartCount();
        UI.showMessage(`"${product.title}" added to your cart! üõí`, "success");
      } else if (cart.find(item => item._id === productId)) {
        UI.showMessage("Item already in cart!", "warning");
      }
    }

    function viewDetails(productId) {
      window.location.href = `itemDetail.html?id=${productId}`;
    }

    function toggleCart() {
      const cartSection = document.getElementById("cart-section");
      const isVisible = cartSection.style.display === "block";
      cartSection.style.display = isVisible ? "none" : "block";
      if (!isVisible) displayCart();
    }

    function displayCart() {
      const cartItems = document.getElementById("cart-items");
      const cartSummary = document.getElementById("cart-summary");
      const cartTotal = document.getElementById("cart-total");
      const cartPoints = document.getElementById("cart-points");
      
      cartItems.innerHTML = "";

      if (cart.length === 0) {
        cartItems.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
        cartSummary.style.display = "none";
        return;
      }

      let totalPrice = 0;
      let totalPoints = 0;

      cart.forEach((item, index) => {
        const cartItem = document.createElement("div");
        cartItem.className = "cart-item";
        cartItem.innerHTML = `
          <div>
            <strong>${item.title}</strong><br>
            <small>Size: ${item.size} | Condition: ${item.condition}</small>
          </div>
          <div>
            <div>${UI.formatPrice(item.price)}</div>
            <div style="color: #388e3c; font-size: 14px;">${Math.round(item.price / 10)} pts</div>
          </div>
        `;
        cartItems.appendChild(cartItem);
        totalPrice += item.price;
        totalPoints += Math.round(item.price / 10);
      });

      cartTotal.textContent = `Total: ${UI.formatPrice(totalPrice)}`;
      cartPoints.textContent = `Points Required: ${totalPoints} pts`;
      cartSummary.style.display = "block";
    }

    function buyWithCash() {
      if (cart.length === 0) return UI.showMessage("Cart is empty!", "warning");
      
      const total = cart.reduce((sum, item) => sum + item.price, 0);
      UI.showMessage(`Thank you! You paid ${UI.formatPrice(total)} in cash. üí∞`, "success");
      cart.length = 0;
      updateCartCount();
      displayCart();
    }

    function buyWithPoints() {
      if (cart.length === 0) return UI.showMessage("Cart is empty!", "warning");
      
      const totalPts = cart.reduce((sum, item) => sum + Math.round(item.price / 10), 0);
      if (userPoints >= totalPts) {
        userPoints -= totalPts;
        UI.showMessage(`Success! You used ${totalPts} points. Remaining: ${userPoints} points ‚≠ê`, "success");
        cart.length = 0;
        updateCartCount();
        updatePointsDisplay();
        displayCart();
      } else {
        UI.showMessage(`Not enough points! You need ${totalPts} points but only have ${userPoints} points.`, "danger");
      }
    }

    async function loadProducts(filters = {}) {
      try {
        const response = await API.getAllItems(filters);
        allProducts = response.items || [];
        renderProducts(allProducts);
      } catch (error) {
        UI.showMessage('Failed to load products: ' + error.message, 'danger');
      }
    }

    function filterProducts() {
      const categoryFilter = document.getElementById("categoryFilter").value;
      const sizeFilter = document.getElementById("sizeFilter").value;
      const conditionFilter = document.getElementById("conditionFilter").value;

      const filters = {};
      if (categoryFilter) filters.category = categoryFilter;
      if (sizeFilter) filters.size = sizeFilter;
      if (conditionFilter) filters.condition = conditionFilter;

      loadProducts(filters);
    }

    // Add event listeners for filters
    document.getElementById("categoryFilter").addEventListener("change", filterProducts);
    document.getElementById("sizeFilter").addEventListener("change", filterProducts);
    document.getElementById("conditionFilter").addEventListener("change", filterProducts);

    // Initialize
    updatePointsDisplay();
    updateCartCount();
    loadProducts();
  </script>
  <script src="../public/database-loader.js"></script>
  <script src="../public/form-handler.js"></script>  <!-- Only for add_items.html -->
  <script src="../public/page-loader.js"></script>

</body>
</html>